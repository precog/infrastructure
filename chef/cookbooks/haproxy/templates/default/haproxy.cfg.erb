global
  #chroot /usr/share/haproxy
  daemon
  user haproxy
  group haproxy
  log localhost daemon notice
  stats socket /var/run/haproxy.stat

  maxconn 20000

  #debug
  #quiet


defaults
  <% @node[:haproxy][:defaults].each do |option| %>
  <%= option %>
  <% end -%>


<% [:frontend,:backend].each do |type| %>
<% @node[:haproxy][type].each do |proxy| %>
<% proxy.each do |name,options| %>
<%= type %> <%= name %>
<% options.each do |option| %>
  <%= option %>
<% end -%>
<% end -%>


<% end -%>
<% end -%>
