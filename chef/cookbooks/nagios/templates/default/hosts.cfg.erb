# Generated by Chef
# host definitions

#<% @nodes.each do |n| -%>
#define host {
#  use server
#  address <%= n['ipaddress'] %>
#  host_name <%= n['hostname'] %>
#<% if n.run_list.roles.nil? || n.run_list.roles.length == 0 -%>
#  hostgroups all
#<% else -%>
#  hostgroups <%= n.run_list.roles.to_a.join(",") %>
#<% end -%>
#}
#
#<% end -%>

# Manual config (for now/testing)

define host {
  use server
  address 50.57.147.129
  host_name devops01
  hostgroups monitoring
}

# Mongo servers
<% require 'resolv'
(1..9).each do |seq| -%>
define host {
  use server
  host_name mongodb0<%= seq %>.reportgrid.com
  address <%= Resolv.getaddress(sprintf("mongodb0%d.reportgrid.com", seq)) %>
<% # Skip arbiters for now based on modulo magic
    if seq % 3 != 0 then -%>
  hostgroups mongodb-replset-server
<%  end -%>
}
<% end -%>

# App servers
<% (1..4).each do |seq| -%>
define host {
  use server
  host_name appserver0<%= seq %>.reportgrid.com
  address <%= Resolv.getaddress(sprintf("appserver0%d.reportgrid.com", seq)) %>
  hostgroups appserver
}
<% end -%>
